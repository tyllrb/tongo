<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Tongo by tyllrb</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Tongo</h1>
          <h2>Node module for chaining together long complex mongodb queries</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/tyllrb/tongo/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/tyllrb/tongo/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/tyllrb/tongo" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="tongo" class="anchor" href="#tongo" aria-hidden="true"><span class="octicon octicon-link"></span></a>tongo</h1>

<p>Node library that adds some tasty syntax sugar to mongodb. Use chaining and promises to string together long complex queries. </p>

<h1>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples</h1>

<h2>
<a id="connecting" class="anchor" href="#connecting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connecting</h2>

<p>Connecting is pretty straightforward</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> Tongo <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>tongo<span class="pl-pds">'</span></span>);

<span class="pl-smi">Tongo</span>.<span class="pl-en">connect</span>({
    <span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>the_password<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>server<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>mongo.server.com<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>database<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>the_database<span class="pl-pds">'</span></span>
})
.<span class="pl-en">then</span>(<span class="pl-k">function</span> () {

    <span class="pl-c">// connection was success</span>

})
.<span class="pl-en">catch</span>(<span class="pl-k">function</span> (<span class="pl-smi">error</span>) {

    <span class="pl-c">// hmm some error occured connecting</span>

});</pre></div>

<h2>
<a id="how-to-get-things-from-the-database" class="anchor" href="#how-to-get-things-from-the-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to get things from the database</h2>

<h3>
<a id="get" class="anchor" href="#get" aria-hidden="true"><span class="octicon octicon-link"></span></a>GET</h3>

<p>Use <code>get</code> and <code>from</code> to get the values of specific fields from a collection. Use <code>*</code> to get all the fields. Note that <code>from</code> must be the last call on the chain, it is the function that returns the promise. </p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Tongo</span>.<span class="pl-en">get</span>(
    <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>userId<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>pic<span class="pl-pds">'</span></span>
)
.<span class="pl-en">from</span>(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>)
.<span class="pl-en">limit</span>(<span class="pl-c1">5</span>)
.<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>) {

    <span class="pl-c">//do something with data</span>

})</pre></div>

<h3>
<a id="where" class="anchor" href="#where" aria-hidden="true"><span class="octicon octicon-link"></span></a>WHERE</h3>

<p>Use <code>where</code> to get fields based on certain conditional values. You can include as many conditions as you like. </p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Tongo</span>.<span class="pl-en">get</span>(
    <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>userId<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>pic<span class="pl-pds">'</span></span>
)
.<span class="pl-en">where</span>({<span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Tyler<span class="pl-pds">'</span></span>})
.<span class="pl-en">from</span>(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>)
.<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>) {

    <span class="pl-c">//do something with data</span>

});</pre></div>

<h4>
<a id="where-operations" class="anchor" href="#where-operations" aria-hidden="true"><span class="octicon octicon-link"></span></a>WHERE operations</h4>

<p>You can specify certain operations for the fields specified in <code>WHERE</code>. </p>

<ul>
<li>
<code>:hash</code> will hash the value you are passing in</li>
<li>
<code>:any</code> is used for fields with arrays, checks to see if the value(s) you have passed in is found in the array</li>
</ul>

<p>Example:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Tongo</span>.<span class="pl-en">get</span>(
    <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>
)
.<span class="pl-en">where</span>({<span class="pl-s"><span class="pl-pds">'</span>password:hash<span class="pl-pds">'</span></span><span class="pl-k">:</span> password, <span class="pl-s"><span class="pl-pds">'</span>friendList:any<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Bob<span class="pl-pds">'</span></span>})
.<span class="pl-en">from</span>(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>)</pre></div>

<h4>
<a id="multiples" class="anchor" href="#multiples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multiples!</h4>

<p>You can also <code>get</code> from multiple collections at once. Using <code>get</code> and <code>where</code> can act as a basic joining of two datasets from different collections. </p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Tongo</span>.<span class="pl-en">get</span>(
    <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>userId<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>comment<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>pic<span class="pl-pds">'</span></span>
)
.<span class="pl-en">where</span>({<span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Tyler<span class="pl-pds">'</span></span>})
.<span class="pl-en">from</span>(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>comments<span class="pl-pds">'</span></span>)
.<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>) {

    <span class="pl-c">//do something with data</span>

});</pre></div>

<p>Here the <code>data</code> will be an object with a field for the results of getting <code>'users'</code>, and a field for the results of getting <code>'comments'</code>.</p>

<h3>
<a id="get-single-record" class="anchor" href="#get-single-record" aria-hidden="true"><span class="octicon octicon-link"></span></a>GET single record</h3>

<p>Use <code>single</code> to query for a single document, useful for when you are expecting just one result.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Tongo</span>.<span class="pl-en">get</span>(
    <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>userId<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>pic<span class="pl-pds">'</span></span>
)
.<span class="pl-en">single</span>()
.<span class="pl-en">where</span>({<span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Tyler<span class="pl-pds">'</span></span>})
.<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>) {

    <span class="pl-c">// do something with data</span>

});</pre></div>

<h3>
<a id="paging" class="anchor" href="#paging" aria-hidden="true"><span class="octicon octicon-link"></span></a>Paging</h3>

<p>Use <code>page</code> and <code>limit</code> to jump forward in the data by a certain amount. Fetching 3 documents on page 0 will get you the first 3 documents, fetching 3 documents on page 1 will get you the 3rd, 4th, and 5th document, fetching 3 documents on page 2 will get you the 6th, 7th, and 8th record, and so on. Useful for implementing paging controls in your UI. </p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Tongo</span>.<span class="pl-en">get</span>(
    <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>userId<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>pic<span class="pl-pds">'</span></span>
)
.<span class="pl-en">limit</span>(<span class="pl-c1">3</span>)
.<span class="pl-en">page</span>(<span class="pl-c1">1</span>)
.<span class="pl-en">from</span>(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>)
.<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>) {

    <span class="pl-c">// you got the 3rd, 4th, and 5th user</span>

});</pre></div>

<h3>
<a id="sorting" class="anchor" href="#sorting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sorting</h3>

<p>Use either <code>ascending()</code> or <code>descending()</code> in the chain to get your results in those respective orders</p>

<h2>
<a id="stuffing-things-into-the-database" class="anchor" href="#stuffing-things-into-the-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stuffing things into the database</h2>

<p>In accordance with REST verbs, <code>put</code> is used to update a document, and <code>post</code> is used for creating a new document. <code>into</code> is used to specify which collection these modifications will be made, note that <code>into</code> is the last call on the chain, it is the function that returns the promise for the entire query. </p>

<h3>
<a id="put" class="anchor" href="#put" aria-hidden="true"><span class="octicon octicon-link"></span></a>PUT</h3>

<p>Use <code>put</code>, <code>where</code> and <code>into</code> to update a document with new values. You can modify an existing field, or add an entire new one. Note that <code>put</code> must have a corresponding <code>where</code> in order to work. </p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Tongo</span>.<span class="pl-en">put</span>({
    <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Tyler2<span class="pl-pds">'</span></span>, <span class="pl-c">// will update the username field with a new value</span>
    <span class="pl-s"><span class="pl-pds">'</span>newFied<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Hello<span class="pl-pds">'</span></span> <span class="pl-c">// this is an entirely new field inserted into the document</span>
})
.<span class="pl-en">where</span>({<span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Tyler<span class="pl-pds">'</span></span>})
.<span class="pl-en">into</span>(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>)
.<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>) {

    <span class="pl-c">// data will be the updated document</span>

});</pre></div>

<h4>
<a id="put-array-operations" class="anchor" href="#put-array-operations" aria-hidden="true"><span class="octicon octicon-link"></span></a>PUT array operations</h4>

<p>Performing array operations is pretty basic, use <code>:add</code> to add something to the array and <code>:removed</code> to remove it. For example, say you have a 'like' array that holds the usernames of those who have 'liked' something. Here is how you would add a new username to that list:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Tongo</span>.<span class="pl-en">put</span>({
    <span class="pl-s"><span class="pl-pds">'</span>likes:add<span class="pl-pds">'</span></span><span class="pl-k">:</span> username
})
.<span class="pl-en">where</span>({<span class="pl-s"><span class="pl-pds">'</span>postId<span class="pl-pds">'</span></span><span class="pl-k">:</span> postId})
.<span class="pl-en">into</span>(<span class="pl-s"><span class="pl-pds">'</span>posts<span class="pl-pds">'</span></span>)
.<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>) {

    <span class="pl-c">// data will be the updated document</span>

});</pre></div>

<h3>
<a id="post-new-document" class="anchor" href="#post-new-document" aria-hidden="true"><span class="octicon octicon-link"></span></a>POST new document</h3>

<p>Use <code>post</code> and <code>into</code> to create a new document in a specified collection. Like using <code>where</code>, multiple collections can be specified. </p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Tongo</span>.<span class="pl-en">post</span>({
    <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>New_User :)<span class="pl-pds">'</span></span>
})
.<span class="pl-en">into</span>(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>)
.<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>) {

    <span class="pl-c">// data will be the newly created document</span>

});</pre></div>

<h4>
<a id="post-aliases" class="anchor" href="#post-aliases" aria-hidden="true"><span class="octicon octicon-link"></span></a>POST aliases</h4>

<p>There are few aliases you can use to generate certain values. </p>

<ul>
<li>
<code>$timestamp</code> will generate a UNIX timestamp </li>
<li>
<code>$id</code> will generate a random string</li>
</ul>

<p>Heres how to use them:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Tongo</span>.<span class="pl-en">post</span>({
    <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Bob<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>date_joined<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>$timestamp<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>userId<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>$id<span class="pl-pds">'</span></span>
})
.<span class="pl-en">into</span>(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>);</pre></div>
        </section>

        <footer>
          Tongo is maintained by <a href="https://github.com/tyllrb">tyllrb</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
